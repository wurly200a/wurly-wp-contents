#+BLOG: wurly-blog
#+POSTID: 1356
#+ORG2BLOG:
#+DATE: [2024-05-18 Sat 22:22]
#+OPTIONS: toc:nil num:nil todo:nil pri:nil tags:nil ^:nil
#+CATEGORY: 
#+TAGS: 
#+DESCRIPTION:
#+TITLE: Ubuntu 22.04 に kubectl をインストール (2024年5月時点)

* 概要

kubernetes(kubectlなど)のインストール方法が変わりました。

下記は、2024年5月時点での最新のやり方です。このやり方ですと、メジャーバージョンを固定してインストールすることになります。

* 以前の設定ファイルの削除

#+begin_src bash
$ cat /etc/apt/sources.list.d/kubernetes.list 
deb [arch=amd64 signed-by=/etc/apt/keyrings/cloud.google.gpg] https://apt.kubernetes.io/ kubernetes-xenial main
#+end_src

#+begin_src bash
$ ls -la /etc/apt/keyrings/
total 40
drwxr-xr-x 2 root root  4096 Nov 26 15:01 .
drwxr-xr-x 8 root root  4096 May  2  2023 ..
-rw-r--r-- 1 root root  1905 Nov 26 14:57 cloud.google.gpg
-rw-r--r-- 1 root root  2760 Nov 26 14:51 docker.gpg
-rw-r--r-- 1 root root 10640 Nov 26 14:29 google-chrome.gpg
-rw-r--r-- 1 root root  1197 Nov 26 15:00 helm.gpg
-rw-r--r-- 1 root root   641 Nov 26 15:01 microsoft.gpg
-rw-r--r-- 1 root root  1185 Nov 23 10:37 nodesource.gpg
#+end_src

#+begin_src bash
$ sudo rm /etc/apt/keyrings/cloud.google.gpg 
$ sudo rm /etc/apt/sources.list.d/kubernetes.list 
#+end_src

* kubectlのインストール v1.29

#+begin_src bash
curl -fsSL https://pkgs.k8s.io/core:/stable:/v1.29/deb/Release.key | sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-apt-keyring.gpg
echo "deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.29/deb/ /" | sudo tee /etc/apt/sources.list.d/kubernetes.list
#+end_src

#+begin_src bash
sudo apt update
sudo apt install kubectl
#+end_src

* 参考
 - [[https://zenn.dev/kariya_mitsuru/articles/a950e0996fb703][apt-key の非推奨化と keyring の扱い方]]
https://zenn.dev/kariya_mitsuru/articles/a950e0996fb703
